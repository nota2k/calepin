// ⚠️ EXEMPLE : Utilisation d'un proxy CORS public
// ⚠️ ATTENTION : Ne pas utiliser en production !
// ⚠️ Cette solution expose vos requêtes à un service tiers

// Option 1 : Utiliser allorigins.win (service public)
const NOTION_API_BASE = 'https://api.allorigins.win/raw?url=' + encodeURIComponent('https://api.notion.com/v1')
const NOTION_SECRET = import.meta.env.VITE_NOTION_SECRET

// Option 2 : Utiliser corsproxy.io (service public)
// const NOTION_API_BASE = 'https://corsproxy.io/?' + encodeURIComponent('https://api.notion.com/v1')

// ⚠️ PROBLÈMES avec cette approche :
// - Toutes vos requêtes passent par un service tiers
// - La clé API est visible dans les logs du service proxy
// - Limites de taux
// - Service peut être indisponible
// - Non sécurisé pour la production

export async function notionRequest(endpoint, options = {}) {
  if (!NOTION_SECRET) {
    throw new Error('VITE_NOTION_SECRET n\'est pas défini')
  }

  const fullUrl = `${NOTION_API_BASE}${endpoint}`

  const response = await fetch(fullUrl, {
    ...options,
    headers: {
      'Authorization': `Bearer ${NOTION_SECRET}`,
      'Notion-Version': '2022-06-28',
      'Content-Type': 'application/json',
      ...options.headers
    }
  })

  if (!response.ok) {
    const error = await response.json().catch(() => ({ message: `HTTP ${response.status}` }))
    throw new Error(error.message || `Erreur HTTP ${response.status}`)
  }

  return response.json()
}

